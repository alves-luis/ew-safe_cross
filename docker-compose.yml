version: '3'
services:
  database:
    image: 'mongo'
    container_name: 'database'
    environment:
      - MONGO_INITDB_ROOT_USERNAME=${MONGO_ROOT_USERNAME}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_ROOT_PASSWORD}
    volumes:
      - ./database-seeds:/docker-entrypoint-initdb.d:ro
    networks:
      - intra_backend

  welcome_service:
    image: 'ambystomatidae/welcome-service:latest'
    container_name: 'welcome_service'
    env_file: ./welcome-service/.env.example
    networks:
      - intra_backend
    depends_on: 
      - database

  nearby_crosswalks_service:
    image: 'ambystomatidae/nearby-crosswalks-service:latest'
    container_name: 'nearby_crosswalks_service'
    env_file: ./nearby-crosswalks-service/.env.example
    networks:
      - intra_backend
    depends_on:
      - database


  spws_web_app:
    image: 'ambystomatidae/spws-web-app:latest'
    container_name: 'spws_web_app'
    ports:
      - '8080:8080'

  spws:
    image: 'ambystomatidae/spws:latest'
    container_name: 'spws'
    env_file: ./spws/.env.example
    ports:
      - '3000:3000'
    networks:
      - intra_backend
    depends_on: 
      - database
      - welcome_service
      - nearby_crosswalks_service

networks:
  intra_backend:
    driver: bridge

    